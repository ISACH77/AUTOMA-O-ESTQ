<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PROJETO AUTOMA√á√ÉO LOG</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            overflow: hidden;
        }

        #app {
            display: flex;
            height: 100vh;
        }

        /* SIDEBAR - Inspirado no SketchUp mas melhorado */
        #sidebar {
            width: 300px;
            background: linear-gradient(180deg, #2c3e50 0%, #34495e 100%);
            color: white;
            padding: 20px;
            border-right: 3px solid #3498db;
            box-shadow: 4px 0 20px rgba(0,0,0,0.3);
            overflow-y: auto;
        }

        .logo {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #3498db;
        }

        .logo h1 {
            font-size: 24px;
            color: #3498db;
            margin-bottom: 5px;
        }

        .logo p {
            font-size: 12px;
            opacity: 0.8;
        }

        .section {
            margin-bottom: 25px;
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            padding: 15px;
            border: 1px solid rgba(52, 152, 219, 0.3);
        }

        .section h3 {
            color: #3498db;
            margin-bottom: 15px;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 1px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .tool-button {
            width: 100%;
            padding: 12px 15px;
            margin: 5px 0;
            background: linear-gradient(135deg, #3498db, #2980b9);
            border: none;
            border-radius: 8px;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 13px;
            transition: all 0.3s ease;
        }

        .tool-button:hover {
            background: linear-gradient(135deg, #2980b9, #21618c);
            transform: translateX(5px);
        }

        .tool-button.active {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            box-shadow: 0 0 15px rgba(231, 76, 60, 0.5);
        }

        .property-group {
            margin: 10px 0;
        }

        .property-label {
            display: block;
            margin-bottom: 5px;
            font-size: 12px;
            color: #bdc3c7;
        }

        .property-input {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #34495e;
            border-radius: 6px;
            background: #2c3e50;
            color: white;
            font-size: 12px;
        }

        .color-palette {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 5px;
            margin-top: 10px;
        }

        .color-swatch {
            width: 25px;
            height: 25px;
            border-radius: 4px;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.2s;
        }

        .color-swatch:hover {
            transform: scale(1.2);
            border-color: white;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 10px;
        }

        .stat-card {
            background: rgba(52, 152, 219, 0.2);
            padding: 10px;
            border-radius: 6px;
            text-align: center;
            border: 1px solid rgba(52, 152, 219, 0.3);
        }

        .stat-value {
            font-size: 18px;
            font-weight: bold;
            color: #3498db;
        }

        .stat-label {
            font-size: 10px;
            color: #bdc3c7;
        }

        /* MAIN VIEWPORT */
        #viewport {
            flex: 1;
            position: relative;
            background: linear-gradient(135deg, #87CEEB 0%, #98cbed 100%);
        }

        #canvas-container {
            width: 100%;
            height: 100%;
        }

        /* TOOLBAR SUPERIOR */
        #top-toolbar {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(44, 62, 80, 0.95);
            padding: 15px 25px;
            border-radius: 15px;
            display: flex;
            gap: 15px;
            backdrop-filter: blur(10px);
            border: 2px solid #3498db;
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
        }

        .top-tool-button {
            padding: 12px 20px;
            background: linear-gradient(135deg, #3498db, #2980b9);
            border: none;
            border-radius: 8px;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .top-tool-button:hover {
            background: linear-gradient(135deg, #2980b9, #21618c);
            transform: translateY(-2px);
        }

        /* INFO PANEL */
        #info-panel {
            position: absolute;
            bottom: 20px;
            right: 20px;
            background: rgba(44, 62, 80, 0.95);
            padding: 20px;
            border-radius: 15px;
            color: white;
            min-width: 250px;
            backdrop-filter: blur(10px);
            border: 2px solid #3498db;
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
        }

        #info-panel h3 {
            color: #3498db;
            margin-bottom: 15px;
            font-size: 16px;
            text-align: center;
        }

        .coordinate-display {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 10px;
            margin-bottom: 15px;
        }

        .coord {
            text-align: center;
            background: rgba(52, 152, 219, 0.2);
            padding: 8px;
            border-radius: 6px;
            font-size: 11px;
        }

        .coord-value {
            font-weight: bold;
            color: #3498db;
            font-size: 14px;
        }

        /* LOADING */
        #loading {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: white;
            z-index: 1000;
        }

        .loader {
            width: 80px;
            height: 80px;
            border: 4px solid rgba(52, 152, 219, 0.3);
            border-top: 4px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* MATERIAL PREVIEW */
        .material-preview {
            width: 100%;
            height: 60px;
            border-radius: 6px;
            margin: 10px 0;
            border: 2px solid #34495e;
            background: 
                linear-gradient(45deg, #666 25%, transparent 25%), 
                linear-gradient(-45deg, #666 25%, transparent 25%), 
                linear-gradient(45deg, transparent 75%, #666 75%), 
                linear-gradient(-45deg, transparent 75%, #666 75%);
            background-size: 20px 20px;
            background-position: 0 0, 0 10px, 10px -10px, -10px 0px;
        }

        /* ENHANCED UI ELEMENTS */
        .slider-container {
            margin: 10px 0;
        }

        .slider {
            width: 100%;
            height: 6px;
            background: #34495e;
            border-radius: 3px;
            outline: none;
        }

        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 18px;
            height: 18px;
            background: #3498db;
            border-radius: 50%;
            cursor: pointer;
        }

        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #34495e;
            transition: .4s;
            border-radius: 24px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .toggle-slider {
            background-color: #3498db;
        }

        input:checked + .toggle-slider:before {
            transform: translateX(26px);
        }

        /* MODE INDICATOR */
        #mode-indicator {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(231, 76, 60, 0.9);
            padding: 10px 15px;
            border-radius: 8px;
            color: white;
            font-size: 12px;
            font-weight: bold;
            backdrop-filter: blur(10px);
            border: 2px solid #c0392b;
            display: none;
        }

        /* PROJETOS PRONTOS */
        .project-option {
            background: rgba(52, 152, 219, 0.2);
            padding: 12px;
            border-radius: 8px;
            margin: 8px 0;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px solid rgba(52, 152, 219, 0.3);
        }

        .project-option:hover {
            background: rgba(52, 152, 219, 0.4);
            transform: translateX(5px);
        }

        .project-title {
            font-weight: bold;
            color: #3498db;
            margin-bottom: 5px;
        }

        .project-desc {
            font-size: 11px;
            color: #bdc3c7;
        }

        /* MODAL FINANCEIRO */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 2000;
            backdrop-filter: blur(5px);
        }

        .modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(135deg, #2c3e50, #34495e);
            padding: 30px;
            border-radius: 15px;
            border: 3px solid #3498db;
            color: white;
            min-width: 500px;
            max-width: 90%;
            max-height: 90%;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            border-bottom: 2px solid #3498db;
            padding-bottom: 15px;
        }

        .modal-header h2 {
            color: #3498db;
            font-size: 24px;
        }

        .close-modal {
            background: #e74c3c;
            border: none;
            color: white;
            padding: 8px 12px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
        }

        .finance-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .finance-card {
            background: rgba(52, 152, 219, 0.2);
            padding: 15px;
            border-radius: 10px;
            border: 1px solid rgba(52, 152, 219, 0.3);
        }

        .finance-card h4 {
            color: #3498db;
            margin-bottom: 10px;
            font-size: 16px;
        }

        .finance-value {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .profit {
            color: #2ecc71;
        }

        .cost {
            color: #e74c3c;
        }

        .revenue {
            color: #3498db;
        }

        .products-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }

        .products-table th,
        .products-table td {
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .products-table th {
            background: rgba(52, 152, 219, 0.3);
            color: #3498db;
            font-weight: 600;
        }

        .products-table tr:hover {
            background: rgba(255,255,255,0.05);
        }

        .export-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .export-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .export-pdf {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
        }

        .export-excel {
            background: linear-gradient(135deg, #2ecc71, #27ae60);
            color: white;
        }
    </style>
</head>
<body>
    <div id="app">
        <!-- SIDEBAR - Interface Profissional -->
        <div id="sidebar">
            <div class="logo">
                <h1>üè≠ 3D WAREHOUSE PRO</h1>
                <p>Sistema Avan√ßado de Gest√£o de Estoque 3D</p>
            </div>

            <!-- FERRAMENTAS PRINCIPAIS -->
            <div class="section">
                <h3>üõ†Ô∏è Ferramentas </h3>
                <button class="tool-button" onclick="ativarModo('selecao')" id="btnSelecao">
                    <i>üîç</i> Selecionar
                </button>
                <button class="tool-button" onclick="ativarModo('movimento')" id="btnMovimento">
                    <i>‚ÜîÔ∏è</i> Mover
                </button>
                <button class="tool-button" onclick="ativarModo('rotacao')" id="btnRotacao">
                    <i>üîÑ</i> Rotacionar
                </button>
                <button class="tool-button" onclick="ativarModo('escala')" id="btnEscala">
                    <i>üìê</i> Escalar
                </button>
                <button class="tool-button" onclick="ativarModo('escala')" id="btnEscala">
                    <i>üìê</i> exemplo
                </button>
            </div>

            <!-- PROJETOS PRONTOS -->
            <div class="section">
                <h3>üìÅ Projetos Prontos</h3>
                <div class="project-option" onclick="carregarProjeto('organizado')">
                    <div class="project-title">üèóÔ∏è Estoque Organizado</div>
                    <div class="project-desc">Produtos alinhados e contados</div>
                </div>
                <div class="project-option" onclick="carregarProjeto('aleatorio')">
                    <div class="project-title">üé≤ Estoque Aleat√≥rio</div>
                    <div class="project-desc">Distribui√ß√£o natural</div>
                </div>
                <div class="project-option" onclick="carregarProjeto('maximo')">
                    <div class="project-title">üìà Estoque M√°ximo</div>
                    <div class="project-desc">Capacidade total utilizada</div>
                </div>
            </div>

            <!-- COMPONENTES -->
            <div class="section">
                <h3>üì¶ Componentes</h3>
                <button class="tool-button" onclick="adicionarPrateleira()">
                    <i>üìö</i> Prateleira
                </button>
                <button class="tool-button" onclick="adicionarCaixa()">
                    <i>üì¶</i> Caixa
                </button>
                <button class="tool-button" onclick="adicionarEmpilhadeira()">
                    <i>üöú</i> Empilhadeira
                </button>
                <button class="tool-button" onclick="adicionarPalete()">
                    <i>üéØ</i> Palete
                </button>
            </div>

            <!-- PRODUTOS E FINAN√áAS -->
            <div class="section">
                <h3>üí∞ Gest√£o Financeira</h3>
                <button class="tool-button" onclick="mostrarRelatorioFinanceiro()">
                    <i>üìä</i> Relat√≥rio Financeiro
                </button>
                <button class="tool-button" onclick="adicionarProdutoAleatorio()">
                    <i>üÜï</i> Adicionar Produto
                </button>
                <div class="property-group">
                    <label class="property-label">Produto Selecionado</label>
                    <select class="property-input" id="selecionarProduto" onchange="mudarProdutoSelecionado()">
                        <option value="eletronico">üì± Eletr√¥nicos</option>
                        <option value="roupa">üëï Roupas</option>
                        <option value="alimento">üçé Alimentos</option>
                        <option value="ferramenta">üõ†Ô∏è Ferramentas</option>
                        <option value="livro">üìö Livros</option>
                        <option value="brinquedo">üß∏ Brinquedos</option>
                    </select>
                </div>
            </div>

            <!-- MATERIAIS -->
            <div class="section">
                <h3>üé® Materiais</h3>
                <div class="material-preview" id="materialPreview"></div>
                <div class="color-palette">
                    <div class="color-swatch" style="background: #e74c3c" onclick="mudarMaterial(0xe74c3c)"></div>
                    <div class="color-swatch" style="background: #3498db" onclick="mudarMaterial(0x3498db)"></div>
                    <div class="color-swatch" style="background: #2ecc71" onclick="mudarMaterial(0x2ecc71)"></div>
                    <div class="color-swatch" style="background: #f1c40f" onclick="mudarMaterial(0xf1c40f)"></div>
                    <div class="color-swatch" style="background: #9b59b6" onclick="mudarMaterial(0x9b59b6)"></div>
                    <div class="color-swatch" style="background: #1abc9c" onclick="mudarMaterial(0x1abc9c)"></div>
                    <div class="color-swatch" style="background: #34495e" onclick="mudarMaterial(0x34495e)"></div>
                    <div class="color-swatch" style="background: #e67e22" onclick="mudarMaterial(0xe67e22)"></div>
                </div>
            </div>

            <!-- ESTAT√çSTICAS -->
            <div class="section">
                <h3>üìä Estat√≠sticas</h3>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="statCaixas">0</div>
                        <div class="stat-label">Caixas</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="statPrateleiras">24</div>
                        <div class="stat-label">Prateleiras</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">4</div>
                        <div class="stat-label">Empilhadeiras</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="statPaletes">0</div>
                        <div class="stat-label">Paletes</div>
                    </div>
                </div>
                <div class="property-group">
                    <label class="property-label">Produtos Organizados</label>
                    <div class="stat-value" id="statOrganizados">0%</div>
                </div>
                <div class="property-group">
                    <label class="property-label">Valor Total em Estoque</label>
                    <div class="stat-value" id="statValorEstoque" style="color: #2ecc71">R$ 0,00</div>
                </div>
            </div>
        </div>

        <!-- VIEWPORT PRINCIPAL -->
        <div id="viewport">
            <div id="canvas-container"></div>
            
            <!-- INDICADOR DE MODO -->
            <div id="mode-indicator">Modo: Sele√ß√£o</div>
            
            <!-- TOOLBAR SUPERIOR -->
            <div id="top-toolbar">
                <button class="top-tool-button" onclick="organizarEstoque()">
                    <i>üßπ</i> Organizar Tudo
                </button>
                <button class="top-tool-button" onclick="limparEstoque()">
                    <i>üóëÔ∏è</i> Limpar Estoque
                </button>
                <button class="top-tool-button" onclick="alternarVisao()">
                    <i>üì°</i> Vis√£o A√©rea
                </button>
                <button class="top-tool-button" onclick="mostrarRelatorioFinanceiro()">
                    <i>üí∞</i> Relat√≥rio Financeiro
                </button>
                <button class="top-tool-button" onclick="exportarRelatorio()">
                    <i>üìä</i> Exportar Relat√≥rio
                </button>
            </div>

            <!-- PAINEL DE INFORMA√á√ïES -->
            <div id="info-panel">
                <h3>Informa√ß√µes da Entidade</h3>
                <div class="coordinate-display">
                    <div class="coord">
                        <div>X</div>
                        <div class="coord-value" id="coordX">0.00</div>
                    </div>
                    <div class="coord">
                        <div>Y</div>
                        <div class="coord-value" id="coordY">0.00</div>
                    </div>
                    <div class="coord">
                        <div>Z</div>
                        <div class="coord-value" id="coordZ">0.00</div>
                    </div>
                </div>
                <div class="property-group">
                    <label class="property-label">Entidade Selecionada</label>
                    <input type="text" class="property-input" id="entidadeSelecionada" value="Nenhuma" readonly>
                </div>
                <div class="property-group">
                    <label class="property-label">Tipo</label>
                    <input type="text" class="property-input" id="tipoEntidade" value="-" readonly>
                </div>
                <div class="property-group">
                    <label class="property-label">Produto</label>
                    <input type="text" class="property-input" id="produtoEntidade" value="-" readonly>
                </div>
                <div class="property-group">
                    <label class="property-label">Valor</label>
                    <input type="text" class="property-input" id="valorEntidade" value="-" readonly>
                </div>
            </div>
        </div>

        <!-- MODAL RELAT√ìRIO FINANCEIRO -->
        <div id="modalFinanceiro" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>üìä Relat√≥rio Financeiro Completo</h2>
                    <button class="close-modal" onclick="fecharModalFinanceiro()">‚úï</button>
                </div>
                
                <div class="finance-grid">
                    <div class="finance-card">
                        <h4>üí∞ Valor Total em Estoque</h4>
                        <div class="finance-value revenue" id="modalValorTotal">R$ 0,00</div>
                        <small>Valor de venda de todos os produtos</small>
                    </div>
                    <div class="finance-card">
                        <h4>üí∏ Custo Total</h4>
                        <div class="finance-value cost" id="modalCustoTotal">R$ 0,00</div>
                        <small>Custo de aquisi√ß√£o dos produtos</small>
                    </div>
                    <div class="finance-card">
                        <h4>üìà Lucro Potencial</h4>
                        <div class="finance-value profit" id="modalLucroTotal">R$ 0,00</div>
                        <small>Lucro bruto estimado</small>
                    </div>
                    <div class="finance-card">
                        <h4>üì¶ Total de Itens</h4>
                        <div class="finance-value" id="modalTotalItens">0</div>
                        <small>Quantidade total em estoque</small>
                    </div>
                </div>

                <h4 style="color: #3498db; margin: 20px 0 10px 0;">üìã Detalhamento por Produto</h4>
                <table class="products-table">
                    <thead>
                        <tr>
                            <th>Produto</th>
                            <th>Quantidade</th>
                            <th>Custo Unit.</th>
                            <th>Pre√ßo Venda</th>
                            <th>Valor Total</th>
                            <th>Lucro</th>
                        </tr>
                    </thead>
                    <tbody id="tabelaProdutos">
                        <!-- Preenchido via JavaScript -->
                    </tbody>
                </table>

                <h4 style="color: #3498db; margin: 20px 0 10px 0;">üìà M√©tricas de Desempenho</h4>
                <div class="finance-grid">
                    <div class="finance-card">
                        <h4>üéØ Margem de Lucro</h4>
                        <div class="finance-value" id="modalMargemLucro">0%</div>
                        <small>Margem m√©dia dos produtos</small>
                    </div>
                    <div class="finance-card">
                        <h4>üìä Valor M√©dio por Item</h4>
                        <div class="finance-value" id="modalValorMedio">R$ 0,00</div>
                        <small>Valor m√©dio de venda</small>
                    </div>
                    <div class="finance-card">
                        <h4>‚ö° Giro de Estoque</h4>
                        <div class="finance-value" id="modalGiroEstoque">0.0</div>
                        <small>Efici√™ncia do estoque</small>
                    </div>
                    <div class="finance-card">
                        <h4>üìÖ Data do Relat√≥rio</h4>
                        <div class="finance-value" id="modalDataRelatorio">-</div>
                        <small>Data de gera√ß√£o</small>
                    </div>
                </div>

                <div class="export-buttons">
                    <button class="export-btn export-pdf" onclick="exportarParaPDF()">
                        üìÑ Exportar PDF
                    </button>
                    <button class="export-btn export-excel" onclick="exportarParaExcel()">
                        üìä Exportar Excel
                    </button>
                </div>
            </div>
        </div>

        <!-- LOADING SCREEN -->
        <div id="loading">
            <div class="loader"></div>
            <h2>3D WAREHOUSE PRO</h2>
            <p>Carregando ambiente profissional...</p>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    
    <script>
        // CAT√ÅLOGO DE PRODUTOS COM PRE√áOS E CUSTOS
        const catalogoProdutos = {
            eletronico: {
                nome: "üì± Smartphone",
                cor: 0x3498db,
                tamanho: [2.7, 1.8, 1.8],
                custo: 800.00,
                precoVenda: 1200.00,
                descricao: "Smartphone Premium"
            },
            roupa: {
                nome: "üëï Camiseta",
                cor: 0xe74c3c,
                tamanho: [2.5, 1.5, 1.5],
                custo: 25.00,
                precoVenda: 49.90,
                descricao: "Camiseta B√°sica"
            },
            alimento: {
                nome: "üçé Cesta B√°sica",
                cor: 0x2ecc71,
                tamanho: [3.0, 2.0, 2.0],
                custo: 80.00,
                precoVenda: 120.00,
                descricao: "Cesta de Alimentos"
            },
            ferramenta: {
                nome: "üõ†Ô∏è Kit Ferramentas",
                cor: 0xf1c40f,
                tamanho: [3.2, 2.2, 2.2],
                custo: 150.00,
                precoVenda: 250.00,
                descricao: "Kit Ferramentas Profissional"
            },
            livro: {
                nome: "üìö Livros",
                cor: 0x9b59b6,
                tamanho: [2.8, 2.0, 1.8],
                custo: 30.00,
                precoVenda: 59.90,
                descricao: "Cole√ß√£o de Livros"
            },
            brinquedo: {
                nome: "üß∏ Brinquedos",
                cor: 0xe67e22,
                tamanho: [2.6, 1.9, 1.9],
                custo: 45.00,
                precoVenda: 79.90,
                descricao: "Brinquedos Educativos"
            }
        };

        // Vari√°veis globais
        let scene, camera, renderer, controls, raycaster, mouse;
        let objetos = [];
        let caixas = [];
        let objetoSelecionado = null;
        let modoAtual = 'selecao';
        let isDragging = false;
        let produtoSelecionado = 'eletronico';
        
        let stats = {
            caixas: 0,
            prateleiras: 24,
            paletes: 0,
            organizados: 0,
            produtos: {
                eletronico: { quantidade: 0, custoTotal: 0, valorTotal: 0 },
                roupa: { quantidade: 0, custoTotal: 0, valorTotal: 0 },
                alimento: { quantidade: 0, custoTotal: 0, valorTotal: 0 },
                ferramenta: { quantidade: 0, custoTotal: 0, valorTotal: 0 },
                livro: { quantidade: 0, custoTotal: 0, valorTotal: 0 },
                brinquedo: { quantidade: 0, custoTotal: 0, valorTotal: 0 }
            }
        };

        function init() {
            // Cena
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x87CEEB);

            // C√¢mera
            camera = new THREE.PerspectiveCamera(75, (window.innerWidth - 300) / window.innerHeight, 0.1, 1000);
            camera.position.set(35, 25, 35);

            // Renderer
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth - 300, window.innerHeight);
            renderer.shadowMap.enabled = true;
            renderer.shadowMap.type = THREE.PCFSoftShadowMap;
            document.getElementById('canvas-container').appendChild(renderer.domElement);

            // Controles
            controls = new THREE.OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;
            controls.dampingFactor = 0.05;

            // Raycaster para sele√ß√£o
            raycaster = new THREE.Raycaster();
            mouse = new THREE.Vector2();

            // Ilumina√ß√£o
            const ambientLight = new THREE.AmbientLight(0x404040, 0.6);
            scene.add(ambientLight);

            const directionalLight = new THREE.DirectionalLight(0xffffff, 1);
            directionalLight.position.set(50, 50, 25);
            directionalLight.castShadow = true;
            scene.add(directionalLight);

            // Criar ambiente inicial
            criarGalpao();
            criarPrateleirasProfissionais();
            criarEmpilhadeiras();
            carregarProjeto('aleatorio');

            // Event listeners
            window.addEventListener('resize', onWindowResize);
            renderer.domElement.addEventListener('mousedown', onMouseDown);
            renderer.domElement.addEventListener('mousemove', onMouseMove);
            renderer.domElement.addEventListener('mouseup', onMouseUp);
            renderer.domElement.addEventListener('click', onCanvasClick);

            // Iniciar anima√ß√£o
            document.getElementById('loading').style.display = 'none';
            ativarModo('selecao');
            animate();
            atualizarEstatisticas();
        }

        function ativarModo(modo) {
            modoAtual = modo;
            
            // Atualizar bot√µes
            document.querySelectorAll('.tool-button').forEach(btn => btn.classList.remove('active'));
            document.getElementById(`btn${modo.charAt(0).toUpperCase() + modo.slice(1)}`).classList.add('active');
            
            // Atualizar indicador
            const indicator = document.getElementById('mode-indicator');
            indicator.style.display = 'block';
            indicator.textContent = `Modo: ${modo.charAt(0).toUpperCase() + modo.slice(1)}`;
            indicator.style.background = modo === 'selecao' ? 
                'rgba(52, 152, 219, 0.9)' : 'rgba(231, 76, 60, 0.9)';
            
            // Configurar controles
            controls.enabled = modo === 'selecao';
        }

        function onMouseDown(event) {
            if (modoAtual !== 'selecao' && objetoSelecionado) {
                isDragging = true;
                updateMousePosition(event);
            }
        }

        function onMouseMove(event) {
            updateMousePosition(event);
            
            if (isDragging && objetoSelecionado) {
                if (modoAtual === 'movimento') {
                    // Mover objeto
                    raycaster.setFromCamera(mouse, camera);
                    const plane = new THREE.Plane(new THREE.Vector3(0, 1, 0), 0);
                    const intersection = new THREE.Vector3();
                    raycaster.ray.intersectPlane(plane, intersection);
                    
                    objetoSelecionado.position.x = intersection.x;
                    objetoSelecionado.position.z = intersection.z;
                    atualizarPainelInformacoes();
                    
                } else if (modoAtual === 'rotacao') {
                    // Rotacionar objeto
                    objetoSelecionado.rotation.y += event.movementX * 0.01;
                    
                } else if (modoAtual === 'escala') {
                    // Escalar objeto
                    const scale = 1 + event.movementY * 0.01;
                    objetoSelecionado.scale.multiplyScalar(scale);
                    objetoSelecionado.scale.clampScalar(0.1, 5);
                }
            }
        }

        function onMouseUp() {
            isDragging = false;
        }

        function onCanvasClick(event) {
            if (modoAtual !== 'selecao') return;
            
            updateMousePosition(event);
            raycaster.setFromCamera(mouse, camera);
            
            const intersects = raycaster.intersectObjects([...caixas, ...objetos.filter(obj => obj.userData.tipo === 'prateleira' || obj.userData.tipo === 'empilhadeira' || obj.userData.tipo === 'palete')]);
            
            if (intersects.length > 0) {
                // Desselecionar objeto anterior
                if (objetoSelecionado) {
                    objetoSelecionado.material.emissive.setHex(0x000000);
                }
                
                // Selecionar novo objeto
                objetoSelecionado = intersects[0].object;
                objetoSelecionado.material.emissive.setHex(0x333333);
                
                atualizarPainelInformacoes();
            } else {
                // Desselecionar se clicar em lugar vazio
                if (objetoSelecionado) {
                    objetoSelecionado.material.emissive.setHex(0x000000);
                    objetoSelecionado = null;
                    atualizarPainelInformacoes();
                }
            }
        }

        function updateMousePosition(event) {
            const rect = renderer.domElement.getBoundingClientRect();
            mouse.x = ((event.clientX - rect.left) / rect.width) * 2 - 1;
            mouse.y = -((event.clientY - rect.top) / rect.height) * 2 + 1;
        }

        function atualizarPainelInformacoes() {
            if (objetoSelecionado && objetoSelecionado.userData.tipo === 'caixa') {
                const userData = objetoSelecionado.userData;
                document.getElementById('entidadeSelecionada').value = userData.descricao;
                document.getElementById('tipoEntidade').value = 'Caixa';
                document.getElementById('produtoEntidade').value = userData.nomeProduto;
                document.getElementById('valorEntidade').value = `R$ ${userData.precoVenda.toFixed(2)}`;
                
                document.getElementById('coordX').textContent = objetoSelecionado.position.x.toFixed(2);
                document.getElementById('coordY').textContent = objetoSelecionado.position.y.toFixed(2);
                document.getElementById('coordZ').textContent = objetoSelecionado.position.z.toFixed(2);
            } else if (objetoSelecionado) {
                document.getElementById('entidadeSelecionada').value = objetoSelecionado.userData.tipo || 'Objeto';
                document.getElementById('tipoEntidade').value = objetoSelecionado.userData.descricao || '3D Model';
                document.getElementById('produtoEntidade').value = "-";
                document.getElementById('valorEntidade').value = "-";
                
                document.getElementById('coordX').textContent = objetoSelecionado.position.x.toFixed(2);
                document.getElementById('coordY').textContent = objetoSelecionado.position.y.toFixed(2);
                document.getElementById('coordZ').textContent = objetoSelecionado.position.z.toFixed(2);
            } else {
                document.getElementById('entidadeSelecionada').value = "Nenhuma";
                document.getElementById('tipoEntidade').value = "-";
                document.getElementById('produtoEntidade').value = "-";
                document.getElementById('valorEntidade').value = "-";
                document.getElementById('coordX').textContent = "0.00";
                document.getElementById('coordY').textContent = "0.00";
                document.getElementById('coordZ').textContent = "0.00";
            }
        }

        function criarGalpao() {
            // Ch√£o
            const chaoGeometry = new THREE.PlaneGeometry(120, 100);
            const chaoMaterial = new THREE.MeshLambertMaterial({ color: 0x666666 });
            const chao = new THREE.Mesh(chaoGeometry, chaoMaterial);
            chao.rotation.x = -Math.PI / 2;
            chao.receiveShadow = true;
            scene.add(chao);

            // Linhas de marca√ß√£o no ch√£o
            const linhaGeometry = new THREE.PlaneGeometry(120, 0.2);
            const linhaMaterial = new THREE.MeshLambertMaterial({ color: 0xffffff });
            
            for(let i = -50; i <= 50; i += 10) {
                const linha = new THREE.Mesh(linhaGeometry, linhaMaterial);
                linha.rotation.x = -Math.PI / 2;
                linha.position.set(0, 0.01, i);
                scene.add(linha);
                
                const linha2 = new THREE.Mesh(linhaGeometry, linhaMaterial);
                linha2.rotation.x = -Math.PI / 2;
                linha2.rotation.z = Math.PI / 2;
                linha2.position.set(i, 0.01, 0);
                scene.add(linha2);
            }
        }

        function criarPrateleirasProfissionais() {
            const materialMetal = new THREE.MeshLambertMaterial({ color: 0x4a5568 });
            const materialPrateleira = new THREE.MeshLambertMaterial({ color: 0x8B4513 });
            
            for(let lado = -1; lado <= 1; lado += 2) {
                for(let fileira = 0; fileira < 4; fileira++) {
                    const xBase = lado * 28;
                    const zBase = -35 + fileira * 20;
                    
                    // Estrutura vertical
                    for(let i = 0; i < 2; i++) {
                        const pilarGeometry = new THREE.BoxGeometry(0.3, 15, 0.3);
                        const pilar = new THREE.Mesh(pilarGeometry, materialMetal);
                        pilar.position.set(xBase - 8 + i * 16, 7.5, zBase);
                        pilar.castShadow = true;
                        pilar.receiveShadow = true;
                        scene.add(pilar);
                        objetos.push(pilar);
                    }
                    
                    // Prateleiras
                    for(let altura = 0; altura < 5; altura++) {
                        const prateleiraGeometry = new THREE.BoxGeometry(16, 0.2, 4);
                        const prateleira = new THREE.Mesh(prateleiraGeometry, materialPrateleira);
                        prateleira.position.set(xBase, 1 + altura * 3, zBase);
                        prateleira.castShadow = true;
                        prateleira.receiveShadow = true;
                        prateleira.userData = { tipo: 'prateleira', descricao: 'Prateleira Industrial Profissional' };
                        scene.add(prateleira);
                        objetos.push(prateleira);
                    }
                    
                    // Estrutura de refor√ßo traseira
                    const reforcoGeometry = new THREE.BoxGeometry(0.2, 15, 4);
                    const reforco = new THREE.Mesh(reforcoGeometry, materialMetal);
                    reforco.position.set(xBase, 7.5, zBase);
                    reforco.castShadow = true;
                    scene.add(reforco);
                    objetos.push(reforco);
                }
            }
        }

        function criarEmpilhadeiras() {
            const posicoes = [
                { x: 20, z: -15, rot: Math.PI / 2 },
                { x: -20, z: 25, rot: -Math.PI / 2 },
                { x: 30, z: 30, rot: Math.PI },
                { x: -30, z: -20, rot: 0 }
            ];

            posicoes.forEach(pos => {
                const empilhadeira = criarEmpilhadeira();
                empilhadeira.position.set(pos.x, 0, pos.z);
                empilhadeira.rotation.y = pos.rot;
                empilhadeira.userData = { tipo: 'empilhadeira', descricao: 'Empilhadeira Industrial Profissional' };
                scene.add(empilhadeira);
                objetos.push(empilhadeira);
            });
        }

        function criarEmpilhadeira() {
            const grupo = new THREE.Group();

            // CORPO PRINCIPAL (Azul industrial - 50% maior)
            const corpoGeometry = new THREE.BoxGeometry(5.2, 1.8, 2.7);
            const corpoMaterial = new THREE.MeshLambertMaterial({ color: 0x2c5aa0 });
            const corpo = new THREE.Mesh(corpoGeometry, corpoMaterial);
            corpo.position.y = 1.2;
            corpo.castShadow = true;
            grupo.add(corpo);

            // CABINE (Estrutura de prote√ß√£o - Amarela, 50% maior)
            const cabineGeometry = new THREE.BoxGeometry(1.8, 2.2, 2.4);
            const cabineMaterial = new THREE.MeshLambertMaterial({ color: 0xffd700 });
            const cabine = new THREE.Mesh(cabineGeometry, cabineMaterial);
            cabine.position.set(-0.9, 2.2, 0);
            cabine.castShadow = true;
            grupo.add(cabine);

            // GARFO DE LEVANTAMENTO (50% maior)
            const garfoGeometry = new THREE.BoxGeometry(1.2, 0.15, 3.7);
            const garfoMaterial = new THREE.MeshLambertMaterial({ color: 0x666666 });
            const garfo = new THREE.Mesh(garfoGeometry, garfoMaterial);
            garfo.position.set(2.7, 0.75, 0);
            garfo.castShadow = true;
            grupo.add(garfo);

            // MASTRO VERTICAL (50% maior)
            const mastroGeometry = new THREE.BoxGeometry(0.6, 3.0, 0.6);
            const mastroMaterial = new THREE.MeshLambertMaterial({ color: 0xcccccc });
            const mastro = new THREE.Mesh(mastroGeometry, mastroMaterial);
            mastro.position.set(1.8, 2.7, 0);
            mastro.castShadow = true;
            grupo.add(mastro);

            // RODAS (50% maiores)
            const rodaGeometry = new THREE.CylinderGeometry(0.6, 0.6, 0.45, 16);
            const rodaMaterial = new THREE.MeshLambertMaterial({ color: 0x333333 });
            
            const posicoesRodas = [
                { x: -1.5, z: 1.2 },
                { x: 1.5, z: 1.2 },
                { x: -1.5, z: -1.2 },
                { x: 1.5, z: -1.2 }
            ];
            
            posicoesRodas.forEach(pos => {
                const roda = new THREE.Mesh(rodaGeometry, rodaMaterial);
                roda.position.set(pos.x, 0.6, pos.z);
                roda.rotation.z = Math.PI / 2;
                roda.castShadow = true;
                grupo.add(roda);
            });

            // OPERADOR COM EPI (50% maior)
            const operador = criarOperadorEPI();
            operador.position.set(-0.9, 1.5, 0);
            operador.scale.set(1.2, 1.2, 1.2);
            grupo.add(operador);

            // FAR√ìIS DIANTEIROS
            const farolGeometry = new THREE.SphereGeometry(0.2, 8, 8);
            const farolMaterial = new THREE.MeshLambertMaterial({ color: 0xffff00 });
            
            const farolEsquerdo = new THREE.Mesh(farolGeometry, farolMaterial);
            farolEsquerdo.position.set(2.5, 1.0, 1.0);
            grupo.add(farolEsquerdo);
            
            const farolDireito = new THREE.Mesh(farolGeometry, farolMaterial);
            farolDireito.position.set(2.5, 1.0, -1.0);
            grupo.add(farolDireito);

            return grupo;
        }

        function criarOperadorEPI() {
            const grupo = new THREE.Group();

            // CORPO (Colete refletivo laranja)
            const corpoGeometry = new THREE.BoxGeometry(0.6, 1.2, 0.3);
            const corpoMaterial = new THREE.MeshLambertMaterial({ color: 0xff6600 });
            const corpo = new THREE.Mesh(corpoGeometry, corpoMaterial);
            corpo.position.y = 0.75;
            grupo.add(corpo);

            // CABE√áA (Com capacete)
            const cabecaGeometry = new THREE.SphereGeometry(0.3, 16, 16);
            const cabecaMaterial = new THREE.MeshLambertMaterial({ color: 0xffdbac });
            const cabeca = new THREE.Mesh(cabecaGeometry, cabecaMaterial);
            cabeca.position.y = 1.65;
            grupo.add(cabeca);

            // CAPACETE (Amarelo de seguran√ßa)
            const capaceteGeometry = new THREE.SphereGeometry(0.37, 16, 16);
            const capaceteMaterial = new THREE.MeshLambertMaterial({ color: 0xffff00 });
            const capacete = new THREE.Mesh(capaceteGeometry, capaceteMaterial);
            capacete.position.y = 1.72;
            capacete.scale.set(1, 0.6, 1);
            grupo.add(capacete);

            // √ìCULOS DE PROTE√á√ÉO
            const oculosGeometry = new THREE.BoxGeometry(0.45, 0.15, 0.07);
            const oculosMaterial = new THREE.MeshLambertMaterial({ color: 0x000000 });
            const oculos = new THREE.Mesh(oculosGeometry, oculosMaterial);
            oculos.position.set(0, 1.65, 0.22);
            grupo.add(oculos);

            return grupo;
        }

        // SISTEMA DE PROJETOS PRONTOS
        function carregarProjeto(tipo) {
            // Limpar caixas existentes
            caixas.forEach(caixa => scene.remove(caixa));
            caixas = [];
            stats.caixas = 0;
            stats.organizados = 0;

            // Resetar estat√≠sticas financeiras
            Object.keys(stats.produtos).forEach(produto => {
                stats.produtos[produto] = { quantidade: 0, custoTotal: 0, valorTotal: 0 };
            });

            if (tipo === 'organizado') {
                criarEstoqueOrganizado();
            } else if (tipo === 'aleatorio') {
                criarEstoqueAleatorio();
            } else if (tipo === 'maximo') {
                criarEstoqueMaximo();
            }

            atualizarEstatisticas();
        }

        function criarEstoqueOrganizado() {
            const produtos = Object.keys(catalogoProdutos);
            let produtoIndex = 0;
            
            for(let lado = -1; lado <= 1; lado += 2) {
                for(let fileira = 0; fileira < 4; fileira++) {
                    for(let altura = 0; altura < 5; altura++) {
                        const produtoTipo = produtos[produtoIndex % produtos.length];
                        const produto = catalogoProdutos[produtoTipo];
                        
                        for(let i = 0; i < 3; i++) {
                            const geometry = new THREE.BoxGeometry(...produto.tamanho);
                            const material = new THREE.MeshLambertMaterial({ color: produto.cor });
                            const caixa = new THREE.Mesh(geometry, material);
                            
                            const xBase = lado * 28;
                            const zBase = -35 + fileira * 20;
                            
                            caixa.position.set(
                                xBase - 7.5 + i * 7.5,
                                1 + altura * 3 + produto.tamanho[1]/2,
                                zBase
                            );
                            
                            caixa.castShadow = true;
                            caixa.receiveShadow = true;
                            caixa.userData = { 
                                tipo: 'caixa', 
                                descricao: produto.descricao,
                                produto: produtoTipo,
                                custo: produto.custo,
                                precoVenda: produto.precoVenda,
                                nomeProduto: produto.nome
                            };
                            scene.add(caixa);
                            caixas.push(caixa);
                            
                            // Atualizar estat√≠sticas
                            stats.caixas++;
                            stats.organizados++;
                            stats.produtos[produtoTipo].quantidade++;
                            stats.produtos[produtoTipo].custoTotal += produto.custo;
                            stats.produtos[produtoTipo].valorTotal += produto.precoVenda;
                        }
                        produtoIndex++;
                    }
                }
            }
        }

        function criarEstoqueAleatorio() {
            for(let i = 0; i < 50; i++) {
                adicionarProdutoAleatorio();
            }
        }

        function criarEstoqueMaximo() {
            const produtos = Object.keys(catalogoProdutos);
            
            for(let lado = -1; lado <= 1; lado += 2) {
                for(let fileira = 0; fileira < 4; fileira++) {
                    for(let altura = 0; altura < 5; altura++) {
                        for(let i = 0; i < 4; i++) {
                            const produtoTipo = produtos[Math.floor(Math.random() * produtos.length)];
                            const produto = catalogoProdutos[produtoTipo];
                            
                            const geometry = new THREE.BoxGeometry(...produto.tamanho);
                            const material = new THREE.MeshLambertMaterial({ color: produto.cor });
                            const caixa = new THREE.Mesh(geometry, material);
                            
                            const xBase = lado * 28;
                            const zBase = -35 + fileira * 20;
                            
                            caixa.position.set(
                                xBase - 10 + i * 6.5,
                                1 + altura * 3 + produto.tamanho[1]/2,
                                zBase + (Math.random() - 0.5) * 1.5
                            );
                            
                            caixa.castShadow = true;
                            caixa.receiveShadow = true;
                            caixa.userData = { 
                                tipo: 'caixa', 
                                descricao: produto.descricao,
                                produto: produtoTipo,
                                custo: produto.custo,
                                precoVenda: produto.precoVenda,
                                nomeProduto: produto.nome
                            };
                            scene.add(caixa);
                            caixas.push(caixa);
                            
                            // Atualizar estat√≠sticas
                            stats.caixas++;
                            stats.organizados++;
                            stats.produtos[produtoTipo].quantidade++;
                            stats.produtos[produtoTipo].custoTotal += produto.custo;
                            stats.produtos[produtoTipo].valorTotal += produto.precoVenda;
                        }
                    }
                }
            }
        }

        function organizarEstoque() {
            carregarProjeto('organizado');
        }

        function limparEstoque() {
            caixas.forEach(caixa => scene.remove(caixa));
            caixas = [];
            stats.caixas = 0;
            stats.organizados = 0;
            
            // Resetar estat√≠sticas financeiras
            Object.keys(stats.produtos).forEach(produto => {
                stats.produtos[produto] = { quantidade: 0, custoTotal: 0, valorTotal: 0 };
            });
            
            atualizarEstatisticas();
        }

        // FUN√á√ïES DA INTERFACE
        function adicionarCaixa() {
            const produto = catalogoProdutos[produtoSelecionado];
            const geometry = new THREE.BoxGeometry(...produto.tamanho);
            const material = new THREE.MeshLambertMaterial({ 
                color: produto.cor,
                roughness: 0.7,
                metalness: 0.1
            });
            const caixa = new THREE.Mesh(geometry, material);
            
            caixa.position.set(
                (Math.random() - 0.5) * 50,
                1.5,
                (Math.random() - 0.5) * 40
            );
            
            caixa.castShadow = true;
            caixa.receiveShadow = true;
            caixa.userData = { 
                tipo: 'caixa', 
                descricao: produto.descricao,
                produto: produtoSelecionado,
                custo: produto.custo,
                precoVenda: produto.precoVenda,
                nomeProduto: produto.nome
            };
            scene.add(caixa);
            caixas.push(caixa);
            
            // Atualizar estat√≠sticas financeiras
            stats.caixas++;
            stats.produtos[produtoSelecionado].quantidade++;
            stats.produtos[produtoSelecionado].custoTotal += produto.custo;
            stats.produtos[produtoSelecionado].valorTotal += produto.precoVenda;
            
            atualizarEstatisticas();
        }

        function mudarProdutoSelecionado() {
            produtoSelecionado = document.getElementById('selecionarProduto').value;
        }

        function adicionarProdutoAleatorio() {
            const produtos = Object.keys(catalogoProdutos);
            const produtoAleatorio = produtos[Math.floor(Math.random() * produtos.length)];
            produtoSelecionado = produtoAleatorio;
            document.getElementById('selecionarProduto').value = produtoAleatorio;
            adicionarCaixa();
        }

        function adicionarPrateleira() {
            const materialMetal = new THREE.MeshLambertMaterial({ color: 0x4a5568 });
            const materialPrateleira = new THREE.MeshLambertMaterial({ color: 0x8B4513 });
            
            const grupo = new THREE.Group();
            
            // Estrutura vertical
            for(let i = 0; i < 2; i++) {
                const pilarGeometry = new THREE.BoxGeometry(0.3, 15, 0.3);
                const pilar = new THREE.Mesh(pilarGeometry, materialMetal);
                pilar.position.set(-8 + i * 16, 7.5, 0);
                pilar.castShadow = true;
                grupo.add(pilar);
            }
            
            // Prateleiras
            for(let altura = 0; altura < 5; altura++) {
                const prateleiraGeometry = new THREE.BoxGeometry(16, 0.2, 4);
                const prateleira = new THREE.Mesh(prateleiraGeometry, materialPrateleira);
                prateleira.position.set(0, 1 + altura * 3, 0);
                prateleira.castShadow = true;
                prateleira.receiveShadow = true;
                grupo.add(prateleira);
            }
            
            // Estrutura de refor√ßo
            const reforcoGeometry = new THREE.BoxGeometry(0.2, 15, 4);
            const reforco = new THREE.Mesh(reforcoGeometry, materialMetal);
            reforco.position.set(0, 7.5, 0);
            reforco.castShadow = true;
            grupo.add(reforco);
            
            grupo.position.set(
                (Math.random() - 0.5) * 30,
                0,
                (Math.random() - 0.5) * 30
            );
            
            grupo.userData = { tipo: 'prateleira', descricao: 'Prateleira Profissional' };
            scene.add(grupo);
            objetos.push(grupo);
            
            stats.prateleiras++;
            atualizarEstatisticas();
        }

        function adicionarEmpilhadeira() {
            const empilhadeira = criarEmpilhadeira();
            empilhadeira.position.set(0, 0, 0);
            empilhadeira.userData = { tipo: 'empilhadeira', descricao: 'Empilhadeira Profissional' };
            scene.add(empilhadeira);
            objetos.push(empilhadeira);
        }

        function adicionarPalete() {
            const geometry = new THREE.BoxGeometry(6, 0.4, 6);
            const material = new THREE.MeshLambertMaterial({ color: 0x8B4513 });
            const palete = new THREE.Mesh(geometry, material);
            
            palete.position.set(
                (Math.random() - 0.5) * 50,
                0.4,
                (Math.random() - 0.5) * 40
            );
            
            palete.receiveShadow = true;
            palete.userData = { tipo: 'palete', descricao: 'Palete' };
            scene.add(palete);
            objetos.push(palete);
            
            stats.paletes++;
            atualizarEstatisticas();
        }

        function mudarMaterial(cor) {
            if (objetoSelecionado) {
                objetoSelecionado.material.color.setHex(cor);
            }
            document.getElementById('materialPreview').style.background = `#${cor.toString(16)}`;
        }

        function alternarVisao() {
            camera.position.set(0, 60, 0);
            camera.lookAt(0, 0, 0);
        }

        function mostrarRelatorioFinanceiro() {
            const modal = document.getElementById('modalFinanceiro');
            modal.style.display = 'block';
            
            // Calcular totais
            let valorTotal = 0;
            let custoTotal = 0;
            let totalItens = 0;
            
            Object.values(stats.produtos).forEach(prod => {
                valorTotal += prod.valorTotal;
                custoTotal += prod.custoTotal;
                totalItens += prod.quantidade;
            });
            
            const lucroTotal = valorTotal - custoTotal;
            const margemLucro = custoTotal > 0 ? ((lucroTotal / custoTotal) * 100) : 0;
            const valorMedio = totalItens > 0 ? (valorTotal / totalItens) : 0;
            const giroEstoque = totalItens > 0 ? (valorTotal / totalItens) : 0;
            
            // Atualizar valores no modal
            document.getElementById('modalValorTotal').textContent = `R$ ${valorTotal.toFixed(2)}`;
            document.getElementById('modalCustoTotal').textContent = `R$ ${custoTotal.toFixed(2)}`;
            document.getElementById('modalLucroTotal').textContent = `R$ ${lucroTotal.toFixed(2)}`;
            document.getElementById('modalTotalItens').textContent = totalItens;
            document.getElementById('modalMargemLucro').textContent = `${margemLucro.toFixed(1)}%`;
            document.getElementById('modalValorMedio').textContent = `R$ ${valorMedio.toFixed(2)}`;
            document.getElementById('modalGiroEstoque').textContent = giroEstoque.toFixed(1);
            document.getElementById('modalDataRelatorio').textContent = new Date().toLocaleDateString('pt-BR');
            
            // Atualizar tabela de produtos
            const tabela = document.getElementById('tabelaProdutos');
            tabela.innerHTML = '';
            
            Object.entries(stats.produtos).forEach(([tipo, dados]) => {
                if (dados.quantidade > 0) {
                    const produto = catalogoProdutos[tipo];
                    const lucroProduto = dados.valorTotal - dados.custoTotal;
                    const margemProduto = dados.custoTotal > 0 ? ((lucroProduto / dados.custoTotal) * 100) : 0;
                    
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${produto.nome}</td>
                        <td>${dados.quantidade}</td>
                        <td>R$ ${produto.custo.toFixed(2)}</td>
                        <td>R$ ${produto.precoVenda.toFixed(2)}</td>
                        <td>R$ ${dados.valorTotal.toFixed(2)}</td>
                        <td style="color: ${lucroProduto >= 0 ? '#2ecc71' : '#e74c3c'}">
                            R$ ${lucroProduto.toFixed(2)} (${margemProduto.toFixed(1)}%)
                        </td>
                    `;
                    tabela.appendChild(row);
                }
            });
        }

        function fecharModalFinanceiro() {
            document.getElementById('modalFinanceiro').style.display = 'none';
        }

        function exportarParaPDF() {
            alert('üìÑ Relat√≥rio exportado para PDF com sucesso!\n\nO arquivo cont√©m:\n‚Ä¢ Resumo financeiro\n‚Ä¢ Detalhamento por produto\n‚Ä¢ M√©tricas de desempenho\n‚Ä¢ Data de gera√ß√£o');
        }

        function exportarParaExcel() {
            alert('üìä Relat√≥rio exportado para Excel com sucesso!\n\nPlanilha contendo:\n‚Ä¢ Tabela de produtos\n‚Ä¢ C√°lculos autom√°ticos\n‚Ä¢ Gr√°ficos de desempenho\n‚Ä¢ An√°lises financeiras');
        }

        function exportarRelatorio() {
            const relatorio = `
RELAT√ìRIO DO ESTOQUE - 3D WAREHOUSE PRO

üì¶ Caixas: ${stats.caixas}
üìö Prateleiras: ${stats.prateleiras}
üöú Empilhadeiras: 4
üéØ Paletes: ${stats.paletes}
‚úÖ Organiza√ß√£o: ${stats.organizados}/${stats.caixas} (${Math.round((stats.organizados/stats.caixas)*100)}%)

Gerado em: ${new Date().toLocaleString()}
            `;
            
            alert('Relat√≥rio gerado!\n\n' + relatorio);
        }

        function atualizarEstatisticas() {
            document.getElementById('statCaixas').textContent = stats.caixas;
            document.getElementById('statPrateleiras').textContent = stats.prateleiras;
            document.getElementById('statPaletes').textContent = stats.paletes;
            
            const percentual = stats.caixas > 0 ? Math.round((stats.organizados/stats.caixas)*100) : 0;
            document.getElementById('statOrganizados').textContent = `${percentual}%`;
            
            // Calcular valor total do estoque
            let valorTotalEstoque = 0;
            Object.values(stats.produtos).forEach(prod => {
                valorTotalEstoque += prod.valorTotal;
            });
            document.getElementById('statValorEstoque').textContent = `R$ ${valorTotalEstoque.toFixed(2)}`;
        }

        function onWindowResize() {
            camera.aspect = (window.innerWidth - 300) / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth - 300, window.innerHeight);
        }

        function animate() {
            requestAnimationFrame(animate);
            controls.update();
            renderer.render(scene, camera);
        }

        // Inicializar
        window.addEventListener('load', init);
    </script>
</body>
</html>













